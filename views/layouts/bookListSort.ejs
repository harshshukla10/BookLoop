<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
<% books.forEach(book=> { %>
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100 shadow position-relative">
            <% if (book.badges && book.badges.length) { %>
                <div class="position-absolute top-0 end-0 p-2">
                    <% book.badges.forEach(badge=> { %>
                        <span class="badge bg-warning text-dark me-1">
                            <%= badge %>
                        </span>
                        <% }) %>
                </div>
                <% } %>
                    <img src="<%= book.bookCoverPhoto %>" class="card-img-top" alt="<%= book.title %>"
                        style="height:500px;object-fit:cover;">
                    <div class="card-body">
                        <h5 class="card-title">
                            <%= book.title %>
                        </h5>
                        <h6 class="card-subtitle mb-2 text-muted">by <%= book.authors %>
                        </h6>
                        <p>
                            <% if (book.originalPrice) { %>
                                <span class="fw-bold text-success">₹<%= book.price %></span>
                                <small class="text-decoration-line-through text-muted">₹<%= book.originalPrice %>
                                        </small>
                                <% } else { %>
                                    <span class="fw-bold text-success">₹<%= book.price %>
                                    </span>
                                    <% } %>
                        </p>
                        <span
                            class="badge <%= book.condition === 'New' ? 'bg-success' : (book.condition === 'Good' ? 'bg-primary' : 'bg-secondary') %>">
                            <%= book.condition %>
                        </span>
                        <p class="mt-2 mb-1"><i class="bi bi-geo-alt"></i>
                            <%= book.location %> (<%= book.deliveryDistanceKm %> km)
                        </p>
                        <p class="card-text">
                            <%= book.description %>
                        </p>
                        <div class="d-flex gap-2 mt-2">
                            <button class="btn btn-primary btn-sm view-details-btn" data-book-id="<%= book._id %>">
                                <i class="bi bi-eye"></i> Details
                            </button>

                            <button class="btn btn-success btn-sm">
                                <i class="bi bi-cart-plus"></i> Buy
                            </button>
                            <% if (book.exchangeAvailable) { %>
                                <button class="btn btn-warning btn-sm"><i class="bi bi-arrow-left-right"></i>
                                    Exchange</button>
                                <% } %>
                        </div>
                    </div>
        </div>
    </div>
    <% }) %>
<!-- Book details modal --><!-- After your book cards in bookListSort.ejs -->
<script>
    window.booksData = <%- JSON.stringify(books) %>;
    </script>
        <script>
            document.addEventListener("click", function (e) {
                const btn = e.target.closest(".view-details-btn");
                if (btn) {
                    const bookId = btn.getAttribute("data-book-id");
                    if (typeof window.showBookDetails === "function") {
                        window.showBookDetails(bookId);
                    }
                }
            });

        </script>